{
  "kind": "build_request",
  "title": "Fix donor sorting logic and add Call Count to Total Donor List",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-38",
      "text": "Reverse the sorting logic in AppointedDonorsList.tsx so that donors who were NOT called recently appear at the TOP and donors who were called most recently appear at the BOTTOM (descending lastCalledDate with nulls first)",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "Donors who were NOT called recently should appear at the TOP. Donors who were called most recently should appear at the BOTTOM."
        ]
      },
      "acceptanceCriteria": [
        "Donors with no lastCalledDate (null) appear first",
        "Donors with older lastCalledDate values appear before donors with newer values",
        "The sorting order is descending by lastCalledDate timestamp"
      ]
    },
    {
      "id": "REQ-39",
      "text": "Maintain secondary sorting by Call Count (ascending, lowest first) in AppointedDonorsList.tsx when two donors have the same Last Called Date",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "If two donors have the same last called date, then sort them by lower Call Count first."
        ]
      },
      "acceptanceCriteria": [
        "When lastCalledDate values match, donors with lower callCount appear first",
        "Secondary sort applies correctly across all date groups"
      ]
    },
    {
      "id": "REQ-40",
      "text": "Ensure the Appointed Donors list automatically updates and refreshes instantly after the Call button is clicked to reflect the new sorting order",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "This sorting must update automatically whenever 'call' is clicked. The donor list should refresh instantly after the update."
        ]
      },
      "acceptanceCriteria": [
        "React Query invalidation triggers immediate refetch after recordCall mutation",
        "UI updates without manual refresh or page reload",
        "Sorting reflects the updated lastCalledDate and callCount immediately"
      ]
    },
    {
      "id": "REQ-41",
      "text": "Add a 'Calls' column to the Total Donor List section (DonorTable.tsx) displaying the callCount value for each donor",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "call count mention in both total donor section and appoint donors section"
        ]
      },
      "acceptanceCriteria": [
        "Call Count column is visible in DonorTable component",
        "Column displays the numeric callCount value for each donor",
        "Column header is labeled 'Calls' or 'Call Count'"
      ]
    },
    {
      "id": "REQ-42",
      "text": "Implement alphabetical sorting by donor name as the primary sort in DonorTable.tsx (Total Donor List section)",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "total donor section list should be in alphabetic order and same blood order"
        ]
      },
      "acceptanceCriteria": [
        "Donors are sorted alphabetically by name (A-Z)",
        "Sorting is case-insensitive",
        "Alphabetical order is the primary sort criterion"
      ]
    },
    {
      "id": "REQ-43",
      "text": "Implement secondary sorting by blood group in DonorTable.tsx (Total Donor List section) when donor names are identical",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "total donor section list should be in alphabetic order and same blood order"
        ]
      },
      "acceptanceCriteria": [
        "When names match, donors are sorted by blood group",
        "Blood group sort order follows standard grouping (e.g., A+, A-, B+, B-, AB+, AB-, O+, O-)",
        "Secondary sort only applies when primary sort values are equal"
      ]
    },
    {
      "id": "REQ-44",
      "text": "Ensure the recent call sorting logic (Last Called Date descending, Call Count ascending) applies ONLY to the Appointed Donors section and not to the Total Donor List section",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-final"
        ],
        "quotes": [
          "recent call logic only on appoint donor section"
        ]
      },
      "acceptanceCriteria": [
        "AppointedDonorsList.tsx uses lastCalledDate and callCount for sorting",
        "DonorTable.tsx uses name and blood group for sorting",
        "No call-based sorting logic appears in DonorTable.tsx"
      ]
    }
  ],
  "constraints": [
    "Do not modify the backend schema or add new fields to the Donor type",
    "Preserve existing Call button functionality that records calls before opening the phone dialer",
    "Maintain existing React Query invalidation patterns for real-time updates"
  ],
  "nonGoals": [
    "Adding Call Count column to Blood Requirement results or other sections not mentioned",
    "Changing the sorting behavior in Temporary Rejected or Permanent Rejected sections",
    "Modifying the backend recordCall function logic"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}